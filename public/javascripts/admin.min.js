function setupAssignAllAndNone(b,d,c,a){$(b).click(function(f){var e=$(this).closest(c).find(a);e.attr("checked",true);e.parents("tr").addClass("selected");f.preventDefault()});$(d).click(function(f){var e=$(this).closest(c).find(a);e.attr("checked",false);e.parents("tr").removeClass("selected");f.preventDefault()})}function setupIndexSelectAllAndNone(){$(".index-select-all").click(function(b){var a=$(".index-list").find(".select-item");a.attr("checked",true);a.closest("tr").addClass("selected");b.preventDefault()});$(".index-select-none").click(function(b){var a=$(".index-list").find(".select-item");a.attr("checked",false);a.closest("tr").removeClass("selected");b.preventDefault()})}function setupItemSelection(a){$(a).click(function(){$(this).closest("tr").toggleClass("selected")})}function setupAutocomplete(a,c,b){$(a).autocomplete({source:function(e,d){$.ajax({url:$(c).val(),dataType:"json",data:{term:e.term,transport_mode_id:$("select#route_transport_mode_id").val()},success:function(f){d($.map(f,function(g){return{label:g.name,value:g.name,id:g.id}}))}})},minLength:0,select:function(d,e){$(this).next(b).val(e.item.id)},search:function(d,e){$(this).next(b).val("");if($(this).val().length==0){return false}}})}function setupOrganizationAutocomplete(){setupAutocomplete("input.organization_name_auto","input#operator_name_autocomplete_url","input.organization-id")}function setupStopAutocompletes(){setupAutocomplete("input.from_stop_name_auto","input#stop_name_autocomplete_url","input.from-stop-id");setupAutocomplete("input.to_stop_name_auto","input#stop_name_autocomplete_url","input.to-stop-id")}function setupOperatorAutocomplete(){setupAutocomplete("input.operator_name_auto","input#operator_name_autocomplete_url","input.operator-id")}function setupLocalityAutocomplete(){setupAutocomplete("input.locality_name_auto","input#locality_name_autocomplete_url","input.locality-id")}function setupAddSegmentLink(){$(".add-segment-link").click(function(d){var a=$(this).closest("tr").next(".add-segment-template");var c=a.clone();var b=a.next();if(b.hasClass("odd")){display_class="even"}else{display_class="odd"}c=popoutRouteSegmentRow(c,display_class);a.after(c);d.preventDefault(d)})}function popoutRouteSegmentRow(b,d){b.removeClass("add-segment-template");b.addClass("add-segment-row");b.addClass(d);b.css("display","table-row");var a=new Date().getTime();var c=new RegExp("new_route_segment","g");b.html(function(e,f){return f.replace(c,a)});setupAutocomplete(b.find("input.from_stop_name_auto"),"input#stop_name_autocomplete_url",b.find("input.from-stop-id"));setupAutocomplete(b.find("input.to_stop_name_auto"),"input#stop_name_autocomplete_url",b.find("input.to-stop-id"));return b}function setupSectionControls(){$(".admin-section").hide();$(".admin-section-control").click(function(){var a=$(this).next(".admin-section");var b=$(this).toggleClass("active").css("background-image");if(b.search(/close/)>0){b=b.replace("_close","_open")}else{b=b.replace("_open","_close")}$(this).toggleClass("active").css("background-image",b);a.slideToggle("slow")})}function setupDestroyLink(){$(".destroy-link").submit(function(){if(confirm($("input#destroy_confirmation").val())){return true}else{return false}})}function setupShowRoutes(){for(index in routeSegments){route_init("map_"+index,routeSegments[index])}}function setupShowRoute(){setupOperatorAutocomplete();setupStopAutocompletes();setupAssignAllAndNone(".check-all-route-operators",".uncheck-all-route-operators",".route-operators",".check-route-operator");setupItemSelection(".check-route-operator");setupItemSelection(".check-route-segment");setupAddSegmentLink();route_init("map",routeSegments);setupSectionControls();setupDestroyLink()}function setupNewRoute(){setupOperatorAutocomplete();setupStopAutocompletes();setupAssignAllAndNone(".check-all-route-operators",".uncheck-all-route-operators",".route-operators",".check-route-operator");setupItemSelection(".check-route-operator");setupItemSelection(".check-route-segment");setupAddSegmentLink()}function setupShowStop(){setupLocalityAutocomplete();setupDestroyLink()}function setupNewStop(){setupLocalityAutocomplete()}function setupShowStopArea(){setupAssignAllAndNone(".check-all-stop-area-operators",".uncheck-all-stop-area-operators",".stop-area-operators",".check-stop-area-operator");setupOperatorAutocomplete();setupLocalityAutocomplete();setupDestroyLink()}function setupNewStopArea(){setupLocalityAutocomplete()}function setupShowProblem(){setupOrganizationAutocomplete()}function setupShowIncomingMessage(){setupDestroyLink()};