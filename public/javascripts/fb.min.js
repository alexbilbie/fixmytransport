var fmtPopup=undefined;var fmtPopupName="fmtfblogin";var fmtPopupParams="width=580,height=400,location=no,menubar=no,toolbar=no,scrollbars:auto";var fbButtonState="idle";var fbCallBackUrl="";function facebookLogin(a){var c=$("#user_session_remember_me").is(":checked");var b={access_token:a.session.access_token,token_expiry:a.session.expires,source:"facebook",remember_me:c};if(fmtPopup){fmtPopup.close()}window.externalAuth(b)}function callFacebook(){if(fbButtonState=="idle"){fbButtonState="busy";$(".facebook-login").css("background-repeat","repeat-y");paintFbButton(fbButtonState);var d=$("#user_session_remember_me").is(":checked");var b="https://www.facebook.com/dialog/oauth?";var c=document.location.protocol+"//"+document.location.host+"/facebook_callback.html?fmt_remember="+d;var a=["client_id="+fmt_facebook_app_id,"redirect_uri="+c,"scope=email","response_type=token"];if($(window).width()>600){a.push("display=popup")}else{a.push("display=touch")}fbCallBackUrl=b+a.join("&");fmtPopup=window.open(fbCallBackUrl,fmtPopupName,fmtPopupParams);if(!fmtPopup||fmtPopup.closed||typeof fmtPopup.closed=="undefined"){fbButtonState="blocked"}else{fbButtonState="idle";fmtPopup.focus()}paintFbButton(fbButtonState)}else{if(fbButtonState=="blocked"){if(fbCallBackUrl){fmtPopup=window.open(fbCallBackUrl,fmtPopupName,fmtPopupParams)}else{}fbButtonState="idle"}}if(fbButtonState=="idle"){paintFbButton(fbButtonState)}return false}function paintFbButton(b){var a;switch(b){case"busy":a="-50px";break;case"blocked":a="-100px";break;default:a="0px"}$(".facebook-login").css("background-position","0px "+a)};