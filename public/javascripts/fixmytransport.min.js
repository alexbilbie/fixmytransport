function frontpageScroller(a,b){$('#frontpage-problem-scroller li:not(".hidden")').delay(a).fadeOut(b,function(){$(this).addClass("hidden");if($(this).hasClass("last")){$("#frontpage-problem-scroller li.first").removeClass("hidden").fadeIn(b,function(){frontpageScroller(a,b)})}else{$(this).next().removeClass("hidden").fadeIn(b,function(){frontpageScroller(a,b)})}})}function externalAuth(a){var b=window.location.protocol+"//"+window.location.host+"/user_sessions/external";var c=$('<form action="'+b+'" method="POST"></form>');for(authParam in a){c.append($('<input type="hidden" name="'+authParam+'" value="'+a[authParam]+'">'))}c.append($('<input type="hidden" name="path" value="'+window.location.pathname+window.location.search+'">'));$("body").append(c);c.submit()}$(document).ready(function(){function r(a){var b=a.find(".thread-copy");var c=a.find(".thread-alternative-copy");var d=b.html();var e=c.html();b.html(e);c.html(d);b.find(".unfold_link").click(function(a){a.preventDefault();r($(this).parents(".thread-details"))})}function q(a){options=i();options["error"]=function(){m(a+" #error-base")};options["success"]=function(b){if(b.success){if(b.redirect){window.location=b.redirect}else if(b.html){$("#login-box").dialog("close");$("body").html(b.html)}else{window.location.reload()}}else{h(a,b)}};$(a).ajaxForm(options)}function p(a){$("#campaign-thread").append(a);var b=$("ul#campaign-thread li:last-child a.thread-item");b.click(function(a){a.preventDefault();e($(this).parent("li"))});b.click()}function o(a){options=i();options["error"]=function(){m(a+" .error-text")};options["success"]=function(b){if(b.success){$(a+" #comment_text").val("");$(a+" #comment_mark_fixed").attr("checked",false);$(a+" #comment_mark_open").attr("checked",false);if(b.mark_fixed){$("#banner .container").append('<div class="right"><span class="ribbon">Fixed</span></div>')}if(b.mark_open){$("#banner .container .right").remove()}$(a+" .last_thread_index").remove();if(b.requires_login){$("#login-landing .notice").text(b.notice);$("#login-landing .notice").show();$(".login-box .pane").hide();$("#login-box").dialog({title:"Sign In or Sign Up"});$("#login-landing").show()}else{$("#login-box").dialog("close");$(".no-comments-text").hide();p(b.html)}}else{h(a,b)}};$(a).ajaxForm(options)}function n(a){options=i();options["error"]=function(){m(a+" .error-text")};options["success"]=function(b){if(b.success){if(b.requires_login){$("#login-create-account .notice").text(b.notice);$("#login-create-account .notice").show();$(".login-box .pane").hide();$("#login-box").dialog({title:"Create a FixMyTransport Account"});$("#login-create-account").fadeIn();$("#login-box").dialog("open")}else{window.location=b.redirect}}else{h(a,b)}};$(a).ajaxForm(options)}function m(a){$(a).html("There was a problem contacting the server. Please reload the page and try again.");$(a).show()}function l(a){options=i();options["error"]=function(){m(a+" .error-text")};options["beforeSubmit"]=function(a,b,c){var d=$("#campaign-thread li:last-child .thread-item .num").text();a[a.length]={name:"last_thread_index",value:d}};options["success"]=function(b){if(b.success){$(a+" .error-text").html("");$(a+" .error-text").hide();$(a+" #campaign_update_text").val("");$(a+" #update-notice").html("Your update has been added to your problem history and will be sent to your supporters.");$(a+" #update-notice").fadeIn(1e3,function(){$(this).delay(5e3).fadeOut(1e3)});$(a+" .last_thread_index").remove();p(b.html)}else{h(a,b)}};$(a).ajaxForm(options)}function k(a){options=i();options["error"]=function(){m(a+" .error-text")};options["success"]=function(b){if(b.success){$("#login-box").dialog("close");$(a+" #campaign_update_text").val("");$(a+" .last_thread_index").remove();$(a+" #campaign_update_is_advice_request").remove();p(b.html)}else{h(a,b)}};$(a).ajaxForm(options)}function j(a){options=i();options["success"]=function(a){$("#login-landing .notice").text(a.notice);$("#login-landing .notice").show();$(".login-box .pane").hide();$("#login-box").dialog({title:"Sign In or Sign Up"});$("#login-landing").show();$("#login-box").dialog("open");_gaq.push(["_trackPageview",campaign_data.url+"/login"])};$(a).ajaxForm(options)}function i(){var a={data:{_method:"post"},dataType:"json"};return a}function h(a,b){$(a+" .error").html();$(a+" .error").hide();for(var c in b.errors){$(a+" .error-"+c).html(b.errors[c]);$(a+" .error-"+c).show()}}function g(){f("#guidance-name","#stop_name_form #name");f("#guidance-route-number","#bus_route_form #route_number");f("#guidance-area","#bus_route_form #area");f("#guidance-to","#train_route_form #to");f("#guidance-to","#other_route_form #to");f("#guidance-from","#train_route_form #from");f("#guidance-from","#other_route_form #from")}function f(a,b){$(a).hide();$(b).autofill({value:$(a).text(),defaultTextColor:"#595454",activeTextColor:"#000000"})}function e(a){if(a.hasClass("open")){$(".thread-details",a).hide("blind","",1e3,function(){a.removeClass("open")})}else{a.addClass("open");$(".thread-details",a).show("blind","",1e3)}}function d(){var a="childactive-"+$("#tabs-main-nav li.ui-state-active").attr("id");$("#tabs-main-nav").removeClass(function(a,b){return(b.match(/\bchildactive-\S+/g)||[]).join(" ")});$("#tabs-main-nav").addClass(a)}function c(){if($("#operator-tabs").length>0){$("#operator-tabs").tabs();d()}}function b(){if($("#tabs").length>0){$("#tabs").tabs();if($("#tabs-bus .tabs-sub-nav").length>0){$("#tabs-bus").tabs()}if($("#tabs-coach .tabs-sub-nav").length>0){$("#tabs-coach").tabs()}if($("#tabs-train .tabs-sub-nav").length>0){$("#tabs-train").tabs()}if($("#tabs-ferry .tabs-sub-nav").length>0){$("#tabs-ferry").tabs()}if($("#tabs-metro .tabs-sub-nav").length>0){$("#tabs-metro").tabs()}d()}}$.ajaxSetup({beforeSend:function(a){a.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}});if($("#frontpage-problem-scroller").length>0){var a=0;if($("#frontpage-problem-scroller li img").length>0){a=250}$("#frontpage-problem-scroller").children("li").each(function(b){if($(this).height()>a){a=$(this).height()}});$("#frontpage-problem-scroller").children("li").css({height:a});$("#frontpage-problem-scroller li:not(:first)").addClass("hidden").hide();$("#frontpage-problem-scroller li:first").addClass("first");$("#frontpage-problem-scroller li:last").addClass("last");frontpageScroller(5e3,2e3)}b();c();g();$("#tabs").bind("tabsshow",function(a,b){d()});$("#operator-tabs").bind("tabsshow",function(a,b){d()});$("#RegionMap area").hover(function(){var a=$(this).attr("id");$("#region-list li."+a).addClass("active")},function(){$("#region-list li").removeClass("active")});$(".goto-top").click(function(a){a.preventDefault();$("html, body").animate({scrollTop:0},"slow")});$("#find-stop input, .form-list li input").focus(function(){$(this).parent().addClass("active")});$("#find-stop input, .form-list li input").blur(function(){$(this).parent().removeClass("active")});$("ul.closed-campaign-thread li").removeClass("open");$("ul#campaign-thread li a.thread-item").click(function(a){a.preventDefault();if(!$(this).hasClass("compact"))e($(this).parent("li"))});$(".thread-controls .expand-all").click(function(a){a.preventDefault();e($("ul#campaign-thread li:not(:has(.compact))").not(".open"))});$(".thread-controls .collapse-all").click(function(a){a.preventDefault();e($("ul#campaign-thread li.open:not(:has(.compact))"))});$("#login-box").dialog({autoOpen:false,show:"fade",hide:"fade",modal:true,width:500,title:"Sign In or Sign Up",beforeClose:function(a,b){$("#login-box form").find("#next_action").remove();$("#login-box .error").html();$("#login-box .error").hide();$("#login-box input[type=text]").val("");$("#login-box input[type=password]").val("")}});$(".auth").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#login-landing").show();$("#login-box").dialog({title:"Sign In or Sign Up"});$("#login-box").dialog("open");return false});$(".login-box .pane").not("#login-landing").hide();$(".pane #create-account").click(function(a){a.preventDefault();$(".pane:visible").fadeOut(500,function(){$("#login-box").dialog({title:"Create Account"});$("#login-create-account").fadeIn()})});$(".pane #login-to-account").click(function(a){a.preventDefault();$(".pane:visible").fadeOut(500,function(){$("#login-box").dialog({title:"Sign In or Sign Up"});$("#login-landing").fadeIn()})});$(".facebook-trigger").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#social-message").empty();if(campaign_data.initiator==true){$("#social-message").append("<b>Tell the world about your campaign</b><br/>"+"Post to your Facebook wall and let everyone know!").show()}else{$("#social-message").append("<b>Tell the world you’re a supporter</b><br/>"+"Post to your Facebook wall and let everyone know!").show()}$("#social-share").show();$("#login-box").dialog({title:"Facebook"});$("#login-box").dialog("open");return false});$(".email-trigger").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#email-share").show();$("#login-box").dialog({title:"Email"});$("#login-box").dialog("open");return false});$("#email-share .email-body").click(function(){$(this).select()});$(".fb-feed-button").click(function(a){a.preventDefault();$("#social-message").fadeOut().empty();FB.ui({method:"feed",display:"popup",name:"FixMyTransport campaign: "+campaign_data.title,link:campaign_data.url,picture:document.location.protocol+"//"+document.location.host+"/images/facebook-feed-logo.gif",caption:campaign_data.description,description:campaign_data.facebook_description,message:campaign_data.facebook_message},function(a){$(".login-box .pane").hide();$("#social-message").empty();if(a&&a.post_id){$("<b>Posted on Facebook!</b><br/>"+"Thanks for spreading the word about this campaign!<br/>").appendTo("#social-message")}else{$("<b>Oops — didn’t post on Facebook</b><br/>"+"You cancelled your post this time...<br/>but please do spread the word about this campaign.<br/>").appendTo("#social-message")}$("#social-share").show();$("#login-box").dialog({title:"Facebook"});$("#login-box").dialog("open");$("#social-message").fadeIn()});return false});$(".advice-trigger").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#campaign-update").show();var b=$("#campaign-thread li:last-child .thread-item .num").text();$("#campaign-update-form-modal").append($("<input/>").attr("type","hidden").attr("name","last_thread_index").attr("class","last_thread_index").val(b));$("#login-box").dialog({title:$(".advice-trigger").attr("data-title")});$("#campaign-update-form-modal button[type=submit]").html("Ask for advice");$("#campaign-update-form-modal").append($("<input/>").attr("type","hidden").attr("id","campaign_update_is_advice_request").attr("name","campaign_update[is_advice_request]").val("true"));$("#login-box").dialog("open");return false});$(".update-trigger").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#campaign-update").show();var b=$("#campaign-thread li:last-child .thread-item .num").text();$("#campaign-update-form").append($("<input/>").attr("type","hidden").attr("name","last_thread_index").attr("class","last_thread_index").val(b));$("#login-box").dialog({title:"Update:"});$("#campaign-update-form button[type=submit]").html("Add Update");$("#login-box").dialog("open");return false});$(".comment-trigger").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#comment-and-login").show();var b=$("#campaign-thread li:last-child .thread-item .num").text();$("#comment-form").append($("<input/>").attr("type","hidden").attr("name","last_thread_index").attr("class","last_thread_index").val(b));$("#login-box").dialog({title:$(".comment-trigger").attr("data-title")+":"});$("#login-box").dialog("open");return false});$(".add-photos-trigger").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#campaign-add-photos").show();$("#login-box").dialog({title:"Add a photo"});$("#login-box").dialog("open");return false});$("#static-create-account").click(function(a){a.preventDefault();$(".login-box .pane").hide();$("#login-create-account").show();$("#login-box").dialog({title:"Create Account"});$("#login-box").dialog("open");return false});k("#campaign-update-form-modal");l("#campaign-update-form-static");n("#create-problem");o(".pane #comment-form");j(".login-to-support");q(".pane #login-form");q(".pane #create-account-form");$(".twitter-popup").click(function(a){var b=575,c=400,d=($(window).width()-b)/2,e=($(window).height()-c)/2,f=this.href,g="status=1"+",width="+b+",height="+c+",top="+e+",left="+d;window.open(f,"twitter",g);return false});$(".tipbox").prepend('<div class="tip-nub"></div>');$(".form-1 input, .form-1 textarea").focus(function(){var a=$(this).parent();$(".tipbox").not(".fixed").css({right:"-999999em"});$(".tipbox",a).not(".fixed").css({right:"-350px",opacity:"0"}).animate({opacity:"1"},{duration:500,queue:false})});$(".tip-close").click(function(a){a.preventDefault();$(".tipbox").not(".fixed").animate({opacity:"0"},{duration:500,queue:false})});if($(".gallery a").length>0){$(".gallery a").lightBox({imageLoading:"/images/lightbox-ico-loading.gif",imageBtnClose:"/images/lightbox-btn-close.gif",imageBtnPrev:"/images/lightbox-btn-prev.gif",imageBtnNext:"/images/lightbox-btn-next.gif"})}$("#campaign-thread .unfold_link").click(function(a){a.preventDefault();r($(this).parents(".thread-details"))});$("#campaign-supporters .view-all").click(function(a){a.preventDefault();$.ajax({url:$(this).attr("url"),success:function(a){$("#campaign-supporters").html(a)}})});$(".fancybutton").mousedown(function(){$(this).addClass("mousedown")}).mouseup(function(){$(this).removeClass("mousedown")}).mouseout(function(){$(this).removeClass("mousedown")});if($("#other-country-notice").length>0){$.ajax({url:"/request_country",dataType:"html",success:function(a){if(a!="GB"){$("#other-country-notice").html("Hola! Bonjour! Howdy! We have an <a href='advice'>important message for visitors from outside the United Kingdom </a>");$("#conditional-notice").show()}}})}});window.fbAsyncInit=function(){FB.init({appId:fmt_facebook_app_id,status:false,cookie:true,xfbml:true})};(function(){var a=document.createElement("script");a.async=true;a.src=document.location.protocol+"//connect.facebook.net/en_US/all.js";if(document.getElementById("fb-root")){document.getElementById("fb-root").appendChild(a);if(document.getElementById("fb-like")){FB.XFBML.parse(document.getElementById("fb-like"))}}})()